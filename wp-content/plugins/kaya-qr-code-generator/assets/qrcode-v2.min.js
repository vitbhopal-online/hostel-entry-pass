var QRCode=function(){for(var r=[null,[[10,7,17,13],[1,1,1,1],[]],[[16,10,28,22],[1,1,1,1],[4,16]],[[26,15,22,18],[1,1,2,2],[4,20]],[[18,20,16,26],[2,1,4,2],[4,24]],[[24,26,22,18],[2,1,4,4],[4,28]],[[16,18,28,24],[4,2,4,4],[4,32]],[[18,20,26,18],[4,2,5,6],[4,20,36]],[[22,24,26,22],[4,2,6,6],[4,22,40]],[[22,30,24,20],[5,2,8,8],[4,24,44]],[[26,18,28,24],[5,4,8,8],[4,26,48]],[[30,20,24,28],[5,4,11,8],[4,28,52]],[[22,24,28,26],[8,4,11,10],[4,30,56]],[[22,26,22,24],[9,4,16,12],[4,32,60]],[[24,30,24,20],[9,4,16,16],[4,24,44,64]],[[24,22,24,30],[10,6,18,12],[4,24,46,68]],[[28,24,30,24],[10,6,16,17],[4,24,48,72]],[[28,28,28,28],[11,6,19,16],[4,28,52,76]],[[26,30,28,28],[13,6,21,18],[4,28,54,80]],[[26,28,26,26],[14,7,25,21],[4,28,56,84]],[[26,28,28,30],[16,8,25,20],[4,32,60,88]],[[26,28,30,28],[17,8,25,23],[4,26,48,70,92]],[[28,28,24,30],[17,9,34,23],[4,24,48,72,96]],[[28,30,30,30],[18,9,30,25],[4,28,52,76,100]],[[28,30,30,30],[20,10,32,27],[4,26,52,78,104]],[[28,26,30,30],[21,12,35,29],[4,30,56,82,108]],[[28,28,30,28],[23,12,37,34],[4,28,56,84,112]],[[28,30,30,30],[25,12,40,34],[4,32,60,88,116]],[[28,30,30,30],[26,13,42,35],[4,24,48,72,96,120]],[[28,30,30,30],[28,14,45,38],[4,28,52,76,100,124]],[[28,30,30,30],[29,15,48,40],[4,24,50,76,102,128]],[[28,30,30,30],[31,16,51,43],[4,28,54,80,106,132]],[[28,30,30,30],[33,17,54,45],[4,32,58,84,110,136]],[[28,30,30,30],[35,18,57,48],[4,28,56,84,112,140]],[[28,30,30,30],[37,19,60,51],[4,32,60,88,116,144]],[[28,30,30,30],[38,19,63,53],[4,28,52,76,100,124,148]],[[28,30,30,30],[40,20,66,56],[4,22,48,74,100,126,152]],[[28,30,30,30],[43,21,70,59],[4,26,52,78,104,130,156]],[[28,30,30,30],[45,22,74,62],[4,30,56,82,108,134,160]],[[28,30,30,30],[47,24,77,65],[4,24,52,80,108,136,164]],[[28,30,30,30],[49,25,81,68],[4,28,56,84,112,140,168]]],t=/^\d*$/,e=/^[A-Za-z0-9 $%*+\-.\/:]*$/,n=/^[A-Z0-9 $%*+\-.\/:]*$/,o=[],a=[-1],u=0,f=1;u<255;++u)o.push(f),a[f]=u,f=2*f^(f>=128?285:0);var i=[[]];for(u=0;u<30;++u){for(var c=i[u],s=[],h=0;h<=u;++h){var l=h<u?o[c[h]]:0,v=o[(u+(c[h-1]||0))%255];s.push(a[l^v])}i.push(s)}var p={};for(u=0;u<45;++u)p["0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:".charAt(u)]=u;var g=[function(r,t){return(r+t)%2==0},function(r,t){return r%2==0},function(r,t){return t%3==0},function(r,t){return(r+t)%3==0},function(r,t){return((r/2|0)+(t/3|0))%2==0},function(r,t){return r*t%2+r*t%3==0},function(r,t){return(r*t%2+r*t%3)%2==0},function(r,t){return((r+t)%2+r*t%3)%2==0}],d=function(r){return r>6},m=function(t,e){var n=-8&function(t){var e=r[t],n=16*t*t+128*t+64;return d(t)&&(n-=36),e[2].length&&(n-=25*e[2].length*e[2].length-10*e[2].length-55),n}(t),o=r[t];return n-=8*o[0][e]*o[1][e]},w=function(r,t){switch(t){case 1:return r<10?10:r<27?12:14;case 2:return r<10?9:r<27?11:13;case 4:return r<10?8:16;case 8:return r<10?8:r<27?10:12}},b=function(r,t,e){var n=m(r,e)-4-w(r,t);switch(t){case 1:return 3*(n/10|0)+(n%10<4?0:n%10<7?1:2);case 2:return 2*(n/11|0)+(n%11<6?0:1);case 4:return n/8|0;case 8:return n/13|0}},x=function(r,t){for(var e=r.slice(0),n=r.length,u=t.length,f=0;f<u;++f)e.push(0);for(f=0;f<n;){var i=a[e[f++]];if(i>=0)for(var c=0;c<u;++c)e[f+c]^=o[(i+t[c])%255]}return e.slice(n)},C=function(r,t,e,n){for(var o=r<<n,a=t-1;a>=0;--a)o>>n+a&1&&(o^=e<<a);return r<<n|o},M=function(r,t,e){for(var n=g[e],o=r.length,a=0;a<o;++a)for(var u=0;u<o;++u)t[a][u]||(r[a][u]^=n(a,u));return r},A=function(r,t,e,n){for(var o=r.length,a=21522^C(e<<3|n,5,1335,10),u=0;u<15;++u){var f=[o-1,o-2,o-3,o-4,o-5,o-6,o-7,o-8,7,5,4,3,2,1,0][u];r[[0,1,2,3,4,5,7,8,o-7,o-6,o-5,o-4,o-3,o-2,o-1][u]][8]=r[8][f]=a>>u&1}return r},k=function(r){for(var t=function(r){for(var t=0,e=0;e<r.length;++e)r[e]>=5&&(t+=r[e]-5+3);for(e=5;e<r.length;e+=2){var n=r[e];r[e-1]==n&&r[e-2]==3*n&&r[e-3]==n&&r[e-4]==n&&(r[e-5]>=4*n||r[e+1]>=4*n)&&(t+=40)}return t},e=r.length,n=0,o=0,a=0;a<e;++a){var u,f=r[a];u=[0];for(var i=0;i<e;){for(c=0;i<e&&f[i];++c)++i;for(u.push(c),c=0;i<e&&!f[i];++c)++i;u.push(c)}n+=t(u),u=[0];for(i=0;i<e;){var c;for(c=0;i<e&&r[i][a];++c)++i;for(u.push(c),c=0;i<e&&!r[i][a];++c)++i;u.push(c)}n+=t(u);var s=r[a+1]||[];o+=f[0];for(i=1;i<e;++i){var h=f[i];o+=h,f[i-1]==h&&s[i]===h&&s[i-1]===h&&(n+=3)}}return n+=10*(Math.abs(o/e/e-.5)/.05|0)},L=function(t,e,n,o,a){var u=r[e],f=function(r,t,e,n){var o=[],a=0,u=8,f=e.length,i=function(r,t){if(t>=u){for(o.push(a|r>>(t-=u));t>=8;)o.push(r>>(t-=8)&255);a=0,u=8}t>0&&(a|=(r&(1<<t)-1)<<(u-=t))},c=w(r,t);switch(i(t,4),i(f,c),t){case 1:for(var s=2;s<f;s+=3)i(parseInt(e.substring(s-2,s+1),10),10);i(parseInt(e.substring(s-2),10),[0,4,7][f%3]);break;case 2:for(s=1;s<f;s+=2)i(45*p[e.charAt(s-1)]+p[e.charAt(s)],11);f%2==1&&i(p[e.charAt(s-1)],6);break;case 4:for(s=0;s<f;++s)i(e[s],8)}for(i(0,4),u<8&&o.push(a);o.length+1<n;)o.push(236,17);return o.length<n&&o.push(236),o}(e,n,t,m(e,o)>>3);f=function(r,t,e){for(var n=[],o=r.length/t|0,a=0,u=t-r.length%t,f=0;f<u;++f)n.push(a),a+=o;for(f=u;f<t;++f)n.push(a),a+=o+1;n.push(a);var i=[];for(f=0;f<t;++f)i.push(x(r.slice(n[f],n[f+1]),e));var c=[],s=r.length/t|0;for(f=0;f<s;++f)for(var h=0;h<t;++h)c.push(r[n[h]+f]);for(h=u;h<t;++h)c.push(r[n[h+1]-1]);for(f=0;f<e.length;++f)for(h=0;h<t;++h)c.push(i[h][f]);return c}(f,u[1][o],i[u[0][o]]);var c=function(t){for(var e=r[t],n=function(r){return 4*r+17}(t),o=[],a=[],u=0;u<n;++u)o.push([]),a.push([]);var f=function(r,t,e,n,u){for(var f=0;f<e;++f)for(var i=0;i<n;++i)o[r+f][t+i]=u[f]>>i&1,a[r+f][t+i]=1};f(0,0,9,9,[127,65,93,93,93,65,383,0,64]),f(n-8,0,8,9,[256,127,65,93,93,93,65,127]),f(0,n-8,9,8,[254,130,186,186,186,130,254,0,0]);for(u=9;u<n-8;++u)o[6][u]=o[u][6]=1&~u,a[6][u]=a[u][6]=1;var i=e[2],c=i.length;for(u=0;u<c;++u)for(var s=0==u?c-1:c,h=0==u||u==c-1?1:0;h<s;++h)f(i[u],i[h],5,5,[31,17,21,17,31]);if(d(t)){var l=C(t,6,7973,12),v=0;for(u=0;u<6;++u)for(h=0;h<3;++h)o[u][n-11+h]=o[n-11+h][u]=l>>v++&1,a[u][n-11+h]=a[n-11+h][u]=1}return{matrix:o,reserved:a}}(e),s=c.matrix,h=c.reserved;if(function(r,t,e){for(var n=r.length,o=0,a=-1,u=n-1;u>=0;u-=2){6==u&&--u;for(var f=a<0?n-1:0,i=0;i<n;++i){for(var c=u;c>u-2;--c)t[f][c]||(r[f][c]=e[o>>3]>>(7&~o)&1,++o);f+=a}a=-a}}(s,h,f),a<0){M(s,h,0),A(s,0,o,0);var l=0,v=k(s);for(M(s,h,0),a=1;a<8;++a){M(s,h,a),A(s,0,o,a);var g=k(s);v>g&&(v=g,l=a),M(s,h,a)}a=l}return M(s,h,a),A(s,0,o,a),s},y={generate:function(r,o){var a={numeric:1,alphanumeric:2,octet:4},u={L:1,M:0,Q:3,H:2},f=(o=o||{}).version||-1,i=u[(o.ecclevel||"L").toUpperCase()],c=o.mode?a[o.mode.toLowerCase()]:-1,s="mask"in o?o.mask:-1;if(c<0)c="string"==typeof r?r.match(t)?1:r.match(n)?2:4:4;else if(1!=c&&2!=c&&4!=c)throw"invalid or unsupported mode";if(null===(r=function(r,n){switch(r){case 1:return n.match(t)?n:null;case 2:return n.match(e)?n.toUpperCase():null;case 4:if("string"==typeof n){for(var o=[],a=0;a<n.length;++a){var u=n.charCodeAt(a);u<128?o.push(u):u<2048?o.push(192|u>>6,128|63&u):u<65536?o.push(224|u>>12,128|u>>6&63,128|63&u):o.push(240|u>>18,128|u>>12&63,128|u>>6&63,128|63&u)}return o}return n}}(c,r)))throw"invalid data format";if(i<0||i>3)throw"invalid ECC level";if(f<0){for(f=1;f<=40&&!(r.length<=b(f,c,i));++f);if(f>40)throw"too large data"}else if(f<1||f>40)throw"invalid version";if(-1!=s&&(s<0||s>8))throw"invalid mask";return L(r,f,c,i,s)},generateHTML:function(r,t){t=t||{};for(var e=y.generate(r,t),n=Math.max(t.modulesize||5,.5),o=Math.max(t.margin||4,0),a=t.customcolor,u=t.custombgcolor,f=document.createElement("div"),i=e.length,c=['<table border="0" cellspacing="0" cellpadding="0" style="border:'+n*o+"px solid #fff;background:"+u+'">'],s=0;s<i;++s){c.push("<tr>");for(var h=0;h<i;++h)c.push('<td style="width:'+n+"px;height:"+n+"px"+(e[s][h]?";background:"+a:"")+'"></td>');c.push("</tr>")}return f.className="qrcode",f.innerHTML=c.join("")+"</table>",f},generatePNG:function(r,t){t=t||{};var e,n=y.generate(r,t),o=Math.max(t.modulesize||5,.5),a=Math.max(t.margin||4,0),u=n.length,f=o*(u+2*a),i=t.customcolor,c=t.custombgcolor,s=document.createElement("canvas");if(s.width=s.height=f,!(e=s.getContext("2d")))throw"canvas support is needed for PNG output";e.fillStyle=c,e.fillRect(0,0,f,f),e.fillStyle=i;for(var h=0;h<u;++h)for(var l=0;l<u;++l)n[h][l]&&e.fillRect(o*(a+l),o*(a+h),o,o);return s.toDataURL()}};return y}();